{{ $terraformCodeBlock := `resource "aws_s3_bucket" "mybucket" {
    bucket_prefix = "mybucket"
}

data "archive_file" "lambda_zip" {
    type        = "zip"
    output_path = "lambda.zip"

    source {
    filename = "index.js"
    content = < {
    console.log(JSON.stringify(ev))
}
EOF
    }
}

data "aws_iam_policy_document" "lambda-assume-role-policy" {
    statement {
        actions = ["sts:AssumeRole"]

        principals {
            type        = "Service"
            identifiers = ["lambda.amazonaws.com"]
        }
    }
}

resource "aws_iam_role" "lambda" {
    assume_role_policy = "${data.aws_iam_policy_document.lambda-assume-role-policy.json}"
}

resource "aws_lambda_function" "my_lambda" {
    filename = "${data.archive_file.lambda_zip.output_path}"
    source_code_hash = "${data.archive_file.lambda_zip.output_base64sha256}"
    function_name = "my_lambda"
    role = "${aws_iam_role.lambda.arn}"
    handler = "index.handler"
    runtime = "nodejs8.10"
}

resource "aws_lambda_permission" "allow_bucket" {
    statement_id  = "AllowExecutionFromS3Bucket"
    action        = "lambda:InvokeFunction"
    function_name = "${aws_lambda_function.my_lambda.arn}"
    principal     = "s3.amazonaws.com"
    source_arn    = "${aws_s3_bucket.mybucket.arn}"
}

resource "aws_s3_bucket_notification" "bucket_notification" {
    bucket = "${aws_s3_bucket.mybucket.id}"

    lambda_function {
        lambda_function_arn = "${aws_lambda_function.my_lambda.arn}"
        events              = ["s3:ObjectCreated:*"]
    }
}

output "bucket_name" {
    value = "${aws_s3_bucket.mybucket.id}"
}`}}

{{ $typeScriptCodeBlock := `import * as aws from "@pulumi/aws";
import { readFileSync, readdirSync } from "fs";
import { join as pathjoin } from "path";

const bucket = new aws.s3.Bucket("mybucket");

const folder = "./files";
let files = readdirSync(folder);
for (let file of files) {
    const object = new aws.s3.BucketObject(file, {
        bucket: bucket,
        content: readFileSync(pathjoin(folder, file)).toString("utf8")
    });
}

export const bucketname = bucket.id;` }}

{{ $pythonCodeBlock := ``}}

{{ $goCodeBlock := ``}}

{{ $cSharpCodeBlock := ``}}

<div id="terraformCompareCodeBlock" class="flex mt-10">
    <div class="w-5/12">
        <ul class="code-file-nav">
            <li class="-mb-px mr-1 mt-1">
                <span class="code-file-nav--item">main.tf</span>
            </li>
        </ul>
        {{ partial "code" (dict "code" $terraformCodeBlock "lang" "plain" "mode" "dark" "opts" "linenos=true") }}
    </div>
    <div class="w-1/12 text-center">
        <i class="fas fa-arrow-right text-6xl block mb-20 mt-10"></i>
        <i class="fas fa-arrow-right text-6xl block mb-20"></i>
        <i class="fas fa-arrow-right text-6xl block mb-20"></i>
    </div>
    <div class="w-6/12">
        <ul class="code-file-nav">
            <li class="-mb-px mr-1 mt-1">
                <a class="code-file-nav--item" href="#terraformCompareTypeScript">index.ts</a>
            </li>
            <li class="-mb-px mr-1 mt-1">
                <a class="code-file-nav--item file-not-active" href="#terraformComparePython">__main__.py</a>
            </li>
            <li class="-mb-px mr-1 mt-1">
                <a class="code-file-nav--item file-not-active" href="#terraformCompareGo">main.go</a>
            </li>
            <li class="-mb-px mr-1 mt-1">
                <a class="code-file-nav--item file-not-active" href="#terraformCompareCSharp">Program.cs</a>
            </li>
        </ul>
        <div id="terraformComparePython">
            {{ partial "code" (dict "code" $pythonCodeBlock "lang" "ts" "mode" "dark" "opts" "linenos=true") }}
        </div>
        <div id="terraformCompareGo">
            {{ partial "code" (dict "code" $goCodeBlock "lang" "ts" "mode" "dark" "opts" "linenos=true") }}
        </div>
        <div id="terraformCompareCSharp">
            {{ partial "code" (dict "code" $cSharpCodeBlock "lang" "ts" "mode" "dark" "opts" "linenos=true") }}
        </div>
        <div id="terraformCompareTypeScript">
            {{ partial "code" (dict "code" $typeScriptCodeBlock "lang" "ts" "mode" "dark" "opts" "linenos=true") }}
        </div>
    </div>
</div>
